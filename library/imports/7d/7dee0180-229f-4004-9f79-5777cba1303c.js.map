{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "window",
    "curChannel",
    "self",
    "cc",
    "Class",
    "extends",
    "Component",
    "properties",
    "chatPreab",
    "Prefab",
    "content",
    "Node",
    "tipColor",
    "Color",
    "btnbg",
    "btnList",
    "default",
    "type",
    "Button",
    "labelList",
    "Label",
    "thisChannel",
    "dataList",
    "itemList",
    "onLoad",
    "updataMessageData",
    "SocketEvents",
    "updataChat",
    "updateChannel",
    "enemyPool",
    "NodePool",
    "initCount",
    "i",
    "enemy",
    "instantiate",
    "put",
    "onDestroy",
    "test",
    "data",
    "createItem",
    "ajaxData",
    "HxsgUrl",
    "chatUrl",
    "msg",
    "totalMsg",
    "length",
    "num",
    "keyMsg",
    "item",
    "name",
    "addChild",
    "initChannel",
    "channelEvent",
    "changeChannel",
    "updateBtnBgColor",
    "seq",
    "sequence",
    "moveTo",
    "p",
    "node",
    "x",
    "easing",
    "easeCubicActionOut",
    "runAction",
    "updateBtnTextColor",
    "channel",
    "isCurrent",
    "color",
    "WHITE",
    "on",
    "EventType",
    "TOUCH_END",
    "event",
    "log",
    "items",
    "children",
    "childrenCount",
    "clearChat",
    "richText",
    "getComponent",
    "RichText",
    "maxWidth",
    "width",
    "itemComp",
    "setMsg"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "//当前频道下标：0、区；1、派；2、商；3、世，\r\n//注意：与num值不同，频道channel是以下标0开始\r\nwindow.curChannel = 2;\r\nvar self;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        chatPreab: cc.Prefab,\r\n        content: cc.Node,\r\n        tipColor: cc.Color,      //新消息标识颜色/当前显示聊天页面的标题背景颜色\r\n        btnbg: cc.Node,\r\n        btnList: {\r\n            default: [],\r\n            type: cc.Button\r\n        },\r\n        labelList: {\r\n            default: [],\r\n            type: cc.Label\r\n        },\r\n        thisChannel: -1,        //保存本实例的频道，用于与全局频道值比较\r\n        dataList: [],           //保存获取的聊天数据\r\n        itemList: [],           //保存动态创建的聊天items\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        self = this;\r\n        self.updataMessageData();\r\n        SocketEvents.updataChat = self.updateChannel;\r\n\r\n        this.enemyPool = new cc.NodePool();\r\n        let initCount = 20;\r\n        for (let i = 0; i < initCount; ++i) {\r\n            let enemy = cc.instantiate(this.chatPreab); // 创建节点\r\n            this.enemyPool.put(enemy); // 通过 putInPool 接口放入对象池\r\n        }\r\n        // var socket = new SocketHxsg('ddd');\r\n        // socket.initWS();\r\n    },\r\n\r\n    onDestroy: function () {\r\n        SocketEvents.updataChat = null;\r\n    },\r\n\r\n    test: function () {\r\n        var data = {\r\n            \"id\": 1198,\r\n            \"roleid\": 1001,//游戏角色IDD\r\n            \"rolename\": \"awdawd\",//角色名\r\n            \"message\": \"你是个好人！ <img src=\\\"f000\\\"/>\",//信息\r\n            \"data\": \"Oct 10, 2016 2:00:12 PM\"//时间\r\n        }\r\n        for (var i = 0; i < 3; i++) {\r\n            this.createItem(data);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 获取/更新聊天数据\r\n     */\r\n    updataMessageData: function () {\r\n\r\n\r\n        ajaxData(HxsgUrl.chatUrl, null, function (msg) {\r\n            var totalMsg = msg.msg;\r\n            for (var i = 0; i < totalMsg.length; i++) {\r\n                var num = totalMsg[i][0];\r\n                var keyMsg = totalMsg[i][1];\r\n                self.dataList[num - 1] = keyMsg;\r\n            }\r\n            for (var i = 0; i < 20; i++) {\r\n                var item = cc.instantiate(self.chatPreab);\r\n                item.name = 'chat_' + i;\r\n                self.content.addChild(item);\r\n            }\r\n            self.initChannel();\r\n        })\r\n\r\n        // $.ajax({\r\n        //     type: 'GET',\r\n        //     // url: \"http://119.29.234.184:8080/hxsg/cocos2dIndex/chatMsg\",//测试链接\r\n        //     url: HxsgUrl.chatUrl,\r\n        //     dataType: 'jsonp',\r\n        //     jsonp: \"jsonpCallback\",\r\n        //     success: function (msg) {\r\n        //         //TODO:解析数据\r\n        //         var totalMsg = msg.msg;\r\n        //         for (var i = 0; i < totalMsg.length; i++) {\r\n        //             var num = totalMsg[i][0];\r\n        //             var keyMsg = totalMsg[i][1];\r\n        //             self.dataList[num - 1] = keyMsg;\r\n        //         }\r\n\r\n        //         self.initChannel();\r\n        //     },\r\n        //     error: function () {\r\n        //         cc.log('获取聊天信息数据失败');\r\n        //     }\r\n        // });\r\n    },\r\n\r\n    //--------------------聊天界面窗口管理\r\n    /**\r\n     * 初始化\r\n     */\r\n    initChannel: function () {\r\n        //1、区；2、派；3、商；4、世\r\n        //默认显示商\r\n       // this.clearChat();\r\n        for (var i = 0; i < 4; i++) {\r\n            //动态绑定点击事件\r\n            this.channelEvent(i);\r\n        }\r\n        this.changeChannel();\r\n    },\r\n\r\n    /**\r\n     * 切换频道\r\n     */\r\n    changeChannel: function () {\r\n        //设置新的频道，背景移动到新频道下\r\n        if (this.thisChannel !== curChannel) {\r\n            this.updateBtnBgColor(curChannel);\r\n            this.thisChannel = curChannel;\r\n        }\r\n        self.createItem();\r\n        // this.clearChat();\r\n\r\n\r\n\r\n        // self.content.addChild(item);\r\n    },\r\n\r\n    /**\r\n     * 更新频道背景颜色\r\n     * 频道\r\n     * 是否当前频道\r\n     */\r\n    updateBtnBgColor: function () {\r\n        //移动背景\r\n        var seq = cc.sequence(cc.moveTo(0.2, cc.p(this.btnList[curChannel].node.x, 0)).easing(cc.easeCubicActionOut(1)));\r\n        this.btnbg.runAction(seq);\r\n    },\r\n\r\n    /**\r\n     * 更新拼到文字颜色\r\n     * 频道\r\n     * 是否当前频道\r\n     */\r\n    updateBtnTextColor: function (channel, isCurrent) {\r\n        this.labelList[channel].node.color = isCurrent ? cc.Color.WHITE : this.tipColor;\r\n    },\r\n\r\n    /**\r\n     * 注册按钮点击事件\r\n     */\r\n    channelEvent: function (i) {\r\n        var self = this;\r\n        this.btnList[i].node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            if (curChannel === i) return;\r\n            curChannel = i;\r\n            self.labelList[i].node.color = cc.Color.WHITE;\r\n            self.changeChannel();\r\n            cc.log('click ' + curChannel);\r\n        });\r\n    },\r\n\r\n    updateChannel: function (channel, keyMsg) {\r\n        cc.log(keyMsg);\r\n        if (curChannel === channel) {\r\n            self.dataList[channel] = keyMsg;\r\n            self.changeChannel(channel);\r\n        }\r\n        else {\r\n            self.dataList[channel] = keyMsg;\r\n            self.updateBtnTextColor(channel, false);\r\n        }\r\n    },\r\n\r\n    //--------------------\r\n\r\n    /**\r\n     * 创建聊天item\r\n     */\r\n    createItem: function () {\r\n        var items = self.content.children;\r\n        cc.log( self.content.childrenCount) \r\n        self.clearChat();\r\n        for (var i = 0; i < 20; i++) {\r\n            var data = this.dataList[curChannel][i];\r\n              //data=eval(\"(\"+data+\")\");\r\n            if (data != \"\" && data != null && typeof (data) != 'undefined') {\r\n                var item = items[i];\r\n                //自适应分辨率设置宽度，留出两边的空白,左右各20\r\n                var richText = item.getComponent(cc.RichText);\r\n                richText.maxWidth = self.content.width - 40;\r\n                var itemComp = item.getComponent('ChatLabelEvent');\r\n                itemComp.setMsg(data);\r\n            } else {\r\n                break;\r\n            }\r\n\r\n\r\n\r\n        }\r\n \r\n        \r\n\r\n        // var self = this;\r\n\r\n        // // var item = cc.instantiate(self.chatPreab);\r\n        // var item = this.enemyPool.get();\r\n        // item.name = 'chat_' + data.id;\r\n        // //自适应分辨率设置宽度，留出两边的空白,左右各20\r\n        // var richText = item.getComponent(cc.RichText);\r\n        // richText.maxWidth = self.content.width - 40;\r\n\r\n        // var itemComp = item.getComponent('ChatLabelEvent');\r\n        // itemComp.setMsg(data);\r\n\r\n        // self.content.addChild(item);\r\n        // self.itemList.push(item);\r\n    },\r\n\r\n    /**\r\n     *  清空聊天列表\r\n     */\r\n    clearChat: function () {\r\n        // this.content.removeAllChildren();\r\n        for (var i = 0; i < this.itemList.length; i++) {\r\n            this.enemyPool.put(this.itemList[i]);\r\n            // this.itemList[i].destroy();\r\n        }\r\n        this.itemList = [];\r\n    }\r\n});\r\n"
  ]
}